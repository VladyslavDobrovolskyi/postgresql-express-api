# –û–ø–∏—Å–∞–Ω–∏–µ API:
**REST API**, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ `express` –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–π –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö `PosgreSQL` —Å –ø–æ–º–æ—â—å—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `pg`, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É—è HTTP-–∑–∞–ø—Ä–æ—Å—ã, –∞ —Ç–∞–∫ –∂–µ –ø–æ–ª—É—á–∞—Ç—å –∏—Ö –∏–∑ –±–∞–∑—ã —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ `–ø–∞–≥–∏–Ω–∞—Ü–∏–∏`. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö c –ø–æ–º–æ—â—å—é `express-validator` –∏ –¥–æ—Å—Ç—É–ø –∫ POST-–∑–∞–ø—Ä–æ—Å—É –ø–æ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–º—É `jwt` —Ç–æ–∫–µ–Ω—É. –ö–ª—é—á–µ–≤–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å —ç—Ç–æ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —ç—Ç–æ–≥–æ –±—ã–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `multer`. –í –ø—Ä–æ–µ–∫—Ç–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ç–µ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∫—Ä—ã–≤–∞—é—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å –ø–æ–º–æ—â—å—é –±–∏–±–ª–∏–æ—Ç–µ–∫ `jest` –∏ `supertest`.

**tags:** `Node.js` `Express` `Express-Validator`  `PostgreSQL` `JWT` `Jest`  

**features:** `–ü–∞–≥–∏–Ω–∞—Ü–∏—è` `–û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π —Ç–æ–∫–µ–Ω –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è POST-–∑–∞–ø—Ä–æ—Å–∞` `–í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö` `–í–∞–ª–∏–¥–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è`  `API-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ`

--- 
### üü¢ GET `/token`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

`GET` `/token`

#### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç
`Status: 200 OK`
`Response:`
```
{
"success": true,
"token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwYXlsb2FkIjoxNjk2NzYyMTMxMjk1LCJpYXQiOjE2OTY3NjIxMzEsImV4cCI6MTY5Njc2NDUzMX0.-TJx-W5WPEBIrMqcrGpKg6MNHaCrt7Jwzjt4aZSovao"
}
```

#### –û—à–∏–±–∫–∏

- –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞, API –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫—É `{ success: false, message: 'Internal Server Error' }` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º –æ—Ç–≤–µ—Ç–∞ `500`

### üü¢ GET `/users`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.


#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
 - `page`: (integer - minimum: 1) 
 - `offset`: (integer - minimum: 0)
 - `count`: (integer - default: 5 - minimum: 1 - maximum: 100)
#### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
`GET` `/users?count=10&page=2`
`GET` `/users?count=10&offset=15`

#### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç
`Status: 200 OK`
`Response:`
```
{
"success": true,
"total_pages": 83,
"total_users": 414,
"count": 5,
"page": 1,
"links": {
"next_url": "/users?count=5&page=2",
"prev_url": null
},
"users": [
{
"id": 1,
"name": "Dodo",
"email": "dodo@gmail.com",
"phone": "+3807318281",
"position": "Designer",
"position_id": 2,
"registration_timestamp": 1691672474,
"photo": "http://127.0.0.1:3000/images/users/cadc28928411c5fe.jpg"
}
...
```

#### –û—à–∏–±–∫–∏
- –ï—Å–ª–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞, API –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫—É `{"success": false, "message": "Page not found"}` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º –æ—Ç–≤–µ—Ç–∞ `404`
- –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ –ø—Ä–æ–π–¥–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º –∑–∞–ø—Ä–æ—Å–∞ API –≤–µ—Ä–Ω—ë—Ç –æ—à–∏–±–∫—É `{
    "success": false,
    "message": "Validation failed",
    "fails": {
        "count": [
            "The count must be an integer."
        ],
        "page": [
            "The page must be at least 1."
        ]
    }
}`
- –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞, API –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫—É `{ success: false, message: 'Internal Server Error' }` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º –æ—Ç–≤–µ—Ç–∞ `500`

### üü¢ GET `/users/:id`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –µ–≥–æ id.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:


`GET` `/users/60d7e29b0f2bb638d6a7a18d`


#### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç
`Status: 200 OK`
`Response:`
```
{
    "success": true,
    "user": {
        "id": 1,
        "name": "Dodo",
        "email": "dodo@gmail.com",
        "phone": "+3807318281",
        "position_id": 2,
        "position": "Designer",
        "photo": "http://127.0.0.1:3000/images/users/cadc28928411c5fe.jpg"
    }
}
```

#### –û—à–∏–±–∫–∏

- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º id –Ω–µ –Ω–∞–π–¥–µ–Ω, API –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫—É —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º –æ—Ç–≤–µ—Ç–∞ `404`:
```
{
    "success": false,
    "message": "The user with the requested identifier does not exist.",
    "fails": {
        "user_id": [
            "User not found."
        ]
    }
}
```
- –ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä id –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω—ã–º, API –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫—É —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º –æ—Ç–≤–µ—Ç–∞ `400`:
```
{
    "success": false,
    "message": "Validation failed",
    "fails": {
        "user_id": [
            "The user id must be an integer."
        ]
    }
}

```
- –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞, API –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫—É `{ success: false, message: 'Internal Server Error' }` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º –æ—Ç–≤–µ—Ç–∞ `500`

### üü¢ GET `/positions`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:


`GET` `/posisitions`


#### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç
`Status: 200 OK`
`Response:`
```
{
    "success": true,
    "positions": [
        {
            "id": 1,
            "name": "Security"
        },
        {
            "id": 2,
            "name": "Designer"
        },
        {
            "id": 3,
            "name": "Content manager"
        },
        {
            "id": 4,
            "name": "Lawyer"
        }
    ]
}
```

#### –û—à–∏–±–∫–∏

- –ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, API –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫—É —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º –æ—Ç–≤–µ—Ç–∞ `410`:
```
{
  "success": false,
  "message": "Positions not found"
}
```
- –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞, API –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫—É `{ success: false, message: 'Internal Server Error' }` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º –æ—Ç–≤–µ—Ç–∞ `500`

### üü£ POST `/users`

–°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
#### –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞:
`token` - –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤–∞–ª–∏–¥–Ω—ã–π —Ç–æ–∫–µ–Ω —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å –ø–æ–º–æ—â—å—é `GET` `/token`
#### –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞: 
`name` - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –¥–æ–ª–∂–Ω–æ —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ 2-60 —Å–∏–º–≤–æ–ª–æ–≤
`email` - —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å RFC2822
`phone` - –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å –∫–æ–¥–∞ –£–∫—Ä–∞–∏–Ω—ã +380
`position_id` - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–∑–∏—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏–π —Å –∏—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ API GET api/v1/positions
`photo` - —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å jpg/jpeg –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º, —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º –Ω–µ –±–æ–ª–µ–µ 84x84px –∏ —Ä–∞–∑–º–µ—Ä–æ–º –Ω–µ –±–æ–ª–µ–µ 5 –ú–ë.

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞
`POST` `/users`
`Token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwYXlsb2FkIjoxNjk2NzYyMTMxMjk1LCJpYXQiOjE2OTY3NjIxMzEsImV4cCI6MTY5Njc2NDUzMX0.-TJx-W5WPEBIrMqcrGpKg6MNHaCrt7Jwzjt4aZSovao"`
`Content-Type: application/json`

```
{
    "name": "John Doe",
    "email": "johndoe@example.com",
    "phone": "+380123456789",
    "position_id": 4,
    "photo": {{photo.jpg\jpeg}}
    
}
```

#### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç
`Status: 201 Created`
`Response:`
```
{
  "success" : true,
  "user_id" : 89,
  "message" : "New user successfully registered"
}
```
### –û—à–∏–±–∫–∏ 
- –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –∏—Å—Ç—ë–∫ API –≤–µ—Ä–Ω—ë—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º –æ—Ç–≤–µ—Ç–∞ `401`:
```
{
    "success": false,
    "message": "The token expired."
}
```
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –Ω–æ–º–µ—Ä–æ–º –∏–ª–∏ –ø–æ—á—Ç–æ–π —Å—É—â–µ—Å—Ç–≤—É–µ—Ç API –≤–µ—Ä–Ω—ë—Ç –æ—à–∏–±–∫—É —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º –æ—Ç–≤–µ—Ç–∞ `409`:
```
{
  "success": false,
  "message": "User with this phone or email already exist"
}
```
- –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é API –≤–µ—Ä–Ω—ë—Ç –æ—à–∏–±–∫—É —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `422`:
```
{
    "success": false,
    "message": "Validation failed",
    "fails": {
        "name": [
            "The name must be at least 2 characters."
        ],
        "email": [
            "The email must be a valid email address."
        ],
        "phone": [
            "The phone field is required."
        ],
        "position_id": [
            "The position id must be an integer."
        ],
        "photo": [
            "The photo may not be greater than 5 Mbytes.",
            "Image is invalid."
        ]
    }
}
```
### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤: 
```
‚îú‚îÄ‚îÄ Functions
|  ‚îú‚îÄ‚îÄ createUser.js - (–§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ generateUserAndDoReques() –∏ –≤—ã–≤–æ–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ –∫–æ–Ω—Å–æ–ª—å)
|  ‚îî‚îÄ‚îÄ generateUserAndDoRequest.js (–§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ —Ç–µ—Å—Ç–æ–≤.)
‚îú‚îÄ‚îÄ pagination
|  ‚îú‚îÄ‚îÄ CountPagination.test.js (–ü—Ä–æ–≤–µ—Ä–∫–∏: The count must be an integer, The count must be at least 1, The count may not be greater than 100)  
|  ‚îî‚îÄ‚îÄ PagePagination.test.js (–ü—Ä–æ–≤–µ—Ä–∫–∏: The page must be an integer, The page must be at least 1, Page not found)
‚îú‚îÄ‚îÄ positions
|  ‚îú‚îÄ‚îÄ GetPositions.test.js (–ü—Ä–æ–≤–µ—Ä–∫–∏: Get positions)
|  ‚îú‚îÄ‚îÄ PositionPageNotFound.test.js (–ü—Ä–æ–≤–µ—Ä–∫–∏: Page not found)
|  ‚îî‚îÄ‚îÄ PositionsNotFound.test.js (–ü—Ä–æ–≤–µ—Ä–∫–∏: Positions not found.)
‚îú‚îÄ‚îÄ token
|  ‚îú‚îÄ‚îÄ GetToken.test.js (–ü—Ä–æ–≤–µ—Ä–∫–∏: Get Token)
|  ‚îú‚îÄ‚îÄ TokenExpired.test.js (–ü—Ä–æ–≤–µ—Ä–∫–∏: Token is expired)
|  ‚îî‚îÄ‚îÄ TokenRequired.test.js –ü—Ä–æ–≤–µ—Ä–∫–∏: Tokent is required)
‚îú‚îÄ‚îÄ users
|  ‚îú‚îÄ‚îÄ GetUserById.test.js (Get user by id)
|  ‚îú‚îÄ‚îÄ GetUsers.test.js (Get users)
|  ‚îú‚îÄ‚îÄ PostUsers.test.js (Create user)
|  ‚îú‚îÄ‚îÄ UserIdMustBeAnInteger.test.js (The user id must be an integer)
|  ‚îî‚îÄ‚îÄ UserWithReqIdentDoesNotExist.test.js (The user with the requested identifier does not exist.)
‚îî‚îÄ‚îÄ validation
   ‚îú‚îÄ‚îÄ EmailValidation.test.js (The email must be a valid email address according to RFC2822)
   ‚îú‚îÄ‚îÄ NameValidation.test.js (The name must be at least 2 characters, The name must not exceed 60 characters)
   ‚îú‚îÄ‚îÄ PhoneNumberValidation.test.js (The phone number is required, The phone number should start with the code of Ukraine (+380))
   ‚îú‚îÄ‚îÄ PhotoValidation.test.js (The photo is required, The photo should be in JPG/JPEG format, The photo dimensions must be 84x84 pixels, Invalid image format, The photo size must not exceed 5MB)
   ‚îú‚îÄ‚îÄ PositionIdValidation.test.js (The position id must be an integer)
   ‚îî‚îÄ‚îÄ UserExistenceValidation.test.js (User with this (phone) or email already exist, User with this phone or (email) already exist)
```
